<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üìã Weekly Reference Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #2563eb;
      --success: #059669;
      --danger: #dc2626;
      --text: #1e293b;
      --gray: #6b7280;
      --light-gray: #f8fafc;
      --border: #e2e8f0;
      --shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    body {
      font-family: 'Inter', 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f1f5f9;
      color: var(--text);
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
    }

    .logo {
      max-width: 180px;
      margin: 0 auto 10px;
      display: block;
      border-radius: 8px;
    }

    h1 {
      font-size: 1.8em;
      color: #0f172a;
      margin: 0 0 8px 0;
      font-weight: 600;
    }

    p.subtitle {
      color: #64748b;
      font-size: 1em;
      margin: 0;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 15px 0;
      flex-wrap: wrap;
      gap: 10px;
    }

    .week-info {
      font-size: 0.95em;
      color: #64748b;
    }

    /* Truck Board */
    .truck-board {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    .board-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-weight: 600;
      color: #0f172a;
    }

    .add-truck-input {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: end;
    }

    .add-truck-input input {
      flex: 1;
      min-width: 150px;
    }

    .truck-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .truck-tag {
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.9em;
      font-weight: 500;
      color: white;
      position: relative;
    }

    .truck-pending {
      background-color: var(--danger);
    }

    .truck-done {
      background-color: var(--success);
    }

    .truck-tag .remove {
      margin-left: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    /* Day Table */
    .day-table {
      margin-bottom: 30px;
      background: white;
      border-radius: 12px;
      box-shadow: var(--shadow);
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .day-header {
      background-color: var(--primary);
      color: white;
      padding: 14px 16px;
      font-size: 1.1em;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .summary {
      font-size: 0.85em;
      background: rgba(255,255,255,0.2);
      padding: 2px 8px;
      border-radius: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      border: 1px solid var(--border);
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #f8fafc;
      color: #334155;
      font-weight: 500;
      font-size: 0.9em;
    }

    td {
      font-size: 0.95em;
    }

    input, select, button {
      font-family: 'Inter', sans-serif;
    }

    input, select {
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: 6px;
      width: 100%;
      font-size: 0.95em;
      box-sizing: border-box;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
    }

    button {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #1d4ed8;
    }

    button.danger {
      background-color: var(--danger);
    }

    button.danger:hover {
      background-color: #b91c1c;
    }

    button.small {
      padding: 4px 8px;
      font-size: 0.8em;
      border-radius: 4px;
    }

    button.outline {
      background-color: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }

    button.outline:hover {
      background-color: rgba(37, 99, 235, 0.1);
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.85em;
      font-weight: 500;
      display: inline-block;
    }

    .status-pending { background-color: #fee2e2; color: var(--danger); }
    .status-in-progress { background-color: #fef3c7; color: var(--warning); }
    .status-completed { background-color: #dcfce7; color: var(--success); }

    .x-mark { font-weight: bold; font-size: 1.2em; }
    .check-mark { color: var(--success); font-weight: bold; }

    .add-row {
      display: flex;
      gap: 10px;
      padding: 12px;
      background-color: #f8fafc;
      border-top: 1px solid var(--border);
      flex-wrap: wrap;
    }

    .add-row input {
      flex: 1;
      min-width: 130px;
    }

    .add-row button {
      white-space: nowrap;
    }

    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 160px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -80px;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 0.8em;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    .print-btn {
      font-size: 0.9em;
      padding: 6px 12px;
    }

    @media (max-width: 600px) {
      .controls, .add-truck-input {
        flex-direction: column;
        align-items: stretch;
      }
      .add-row {
        flex-direction: column;
      }
      .add-row input, .add-row button {
        width: 100%;
      }
      .day-header {
        flex-direction: column;
        gap: 6px;
        align-items: stretch;
      }
      .summary {
        order: -1;
      }
    }
  </style>
</head>
<body>

<div class="container">

  <!-- Logo -->
  <header>
    <img src="https://i.imgur.com/9ePBWYP.png" alt="Company Logo" class="logo" />
    <h1>üìã Weekly Reference Tracker</h1>
    <p class="subtitle">Track and manage references and trucks across the week</p>
    <div class="week-info" id="weekLabel">Loading week...</div>
  </header>

  <!-- Truck Board -->
  <section class="truck-board">
    <div class="board-header">
      <span>üöõ Weekly Truck (Remorque) Board</span>
      <span id="truck-stats">Total: 0 | Processed: 0</span>
    </div>
    <div class="add-truck-input">
      <input type="text" id="newTruckInput" placeholder="Enter Remorque Number" />
      <button id="addTruckBtn">Add Truck</button>
    </div>
    <div class="truck-list" id="truckList">
      <!-- Trucks will be added here -->
    </div>
  </section>

  <!-- Controls -->
  <div class="controls">
    <div>
      <input type="text" id="searchInput" placeholder="üîç Search B1 or Remorque..." />
    </div>
    <button class="outline print-btn" onclick="window.print()">üñ®Ô∏è Print Weekly Report</button>
  </div>

  <!-- Daily Tables -->
  <div id="weeklyTables"></div>

  <!-- Footer -->
  <footer style="text-align: center; margin-top: 40px; color: #64748b; font-size: 0.9em;">
    <p>Last updated: <span id="lastUpdated">‚Äî</span></p>
    <p>For internal use only ‚Ä¢ Team Collaboration Tool</p>
  </footer>

</div>

<script>
  const users = ['ABDO', 'MOUAD'];
  const STORAGE_KEY = 'weeklyReferenceTracker';

  // DOM Elements
  const newTruckInput = document.getElementById('newTruckInput');
  const addTruckBtn = document.getElementById('addTruckBtn');

  // Load data
  function loadData() {
    const saved = localStorage.getItem(STORAGE_KEY);
    const data = saved ? JSON.parse(saved) : {};
    const week = generateWeekDates();
    week.forEach(d => {
      if (!data[d.iso]) data[d.iso] = [];
    });
    // Initialize trucks if not exists
    if (!data.trucks) data.trucks = [];
    return data;
  }

  function saveData(data) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
    renderTruckBoard(data);
  }

  // Generate week dates
  function generateWeekDates() {
    const today = new Date();
    const day = today.getDay();
    const startOfWeek = new Date(today);
    startOfWeek.setDate(today.getDate() - day);
    const dates = [];
    for (let i = 0; i < 7; i++) {
      const date = new Date(startOfWeek);
      date.setDate(startOfWeek.getDate() + i);
      const iso = date.toISOString().split('T')[0];
      const name = date.toLocaleDateString('en-US', { weekday: 'long' });
      const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      dates.push({ iso, name, dateStr });
    }
    return dates;
  }

  function formatDateRange(dates) {
    const start = new Date(dates[0].iso);
    const end = new Date(dates[6].iso);
    const options = { month: 'short', day: 'numeric', year: 'numeric' };
    return `Week of ${start.toLocaleDateString('en-US', options)} ‚Äì ${end.toLocaleDateString('en-US', options)}`;
  }

  // Truck Board Functions
  function renderTruckBoard(data) {
    const truckList = document.getElementById('truckList');
    const stats = document.getElementById('truck-stats');
    truckList.innerHTML = '';

    const processedRemorques = new Set();
    Object.values(data).forEach(dayRefs => {
      if (Array.isArray(dayRefs)) {
        dayRefs.forEach(ref => {
          if (ref.remorque && ref.status === 'completed') {
            processedRemorques.add(ref.remorque.trim());
          }
        });
      }
    });

    data.trucks.forEach(truck => {
      const tag = document.createElement('span');
      tag.className = `truck-tag ${processedRemorques.has(truck) ? 'truck-done' : 'truck-pending'}`;
      tag.innerHTML = `${truck} <span class="remove" data-truck="${truck}">√ó</span>`;
      truckList.appendChild(tag);
    });

    stats.textContent = `Total: ${data.trucks.length} | Processed: ${processedRemorques.size}`;
  }

  addTruckBtn.addEventListener('click', () => {
    const truck = newTruckInput.value.trim().toUpperCase();
    if (!truck) {
      alert("Please enter a remorque number.");
      return;
    }

    const data = loadData();
    if (data.trucks.includes(truck)) {
      alert("This remorque is already in the list.");
      return;
    }

    data.trucks.push(truck);
    newTruckInput.value = '';
    saveData(data);
    renderTruckBoard(data);
  });

  // Remove truck
  document.addEventListener('click', (e) => {
    if (e.target.classList.contains('remove') && e.target.parentElement.classList.contains('truck-tag')) {
      const truck = e.target.dataset.truck;
      if (confirm(`Remove remorque ${truck} from the board?`)) {
        const data = loadData();
        data.trucks = data.trucks.filter(t => t !== truck);
        saveData(data);
        renderTruckBoard(data);
      }
    }
  });

  // Render Weekly Tables
  function renderWeek() {
    const week = generateWeekDates();
    const data = loadData();
    const container = document.getElementById('weeklyTables');
    container.innerHTML = '';

    document.getElementById('weekLabel').textContent = formatDateRange(week);
    document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
    renderTruckBoard(data);

    week.forEach(day => {
      const dayData = data[day.iso];
      const total = dayData.length;
      const completed = dayData.filter(r => r.status === 'completed').length;

      const section = document.createElement('div');
      section.className = 'day-table';

      const header = document.createElement('div');
      header.className = 'day-header';
      header.innerHTML = `
        <span>${day.name} - ${day.date}</span>
        <span class="summary">Total: ${total} | Completed: ${completed}</span>
      `;
      section.appendChild(header);

      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      ['B1 NUMBER', 'REMORQUE', 'ASSIGNED TO', 'STATUS', 'ACTIONS'].forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      table.appendChild(thead);

      const tbody = document.createElement('tbody');
      dayData.forEach((ref, index) => {
        const tr = document.createElement('tr');

        const tdB1 = document.createElement('td');
        tdB1.contentEditable = true;
        tdB1.textContent = ref.b1Number || '';
        tdB1.addEventListener('blur', () => {
          ref.b1Number = tdB1.textContent.trim();
          saveData(data);
        });
        tr.appendChild(tdB1);

        const tdRemorque = document.createElement('td');
        tdRemorque.contentEditable = true;
        tdRemorque.textContent = ref.remorque || '';
        tdRemorque.addEventListener('blur', () => {
          ref.remorque = tdRemorque.textContent.trim();
          saveData(data);
          renderTruckBoard(data);
        });
        tr.appendChild(tdRemorque);

        const tdUser = document.createElement('td');
        const select = document.createElement('select');
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = 'Unassigned';
        select.appendChild(defaultOption);
        users.forEach(u => {
          const opt = document.createElement('option');
          opt.value = u;
          opt.textContent = u;
          if (u === ref.user) opt.selected = true;
          select.appendChild(opt);
        });
        select.addEventListener('change', () => {
          ref.user = select.value;
          saveData(data);
        });
        tdUser.appendChild(select);
        tr.appendChild(tdUser);

        const tdStatus = document.createElement('td');
        const statusBadge = document.createElement('span');
        statusBadge.className = 'status-badge';
        statusBadge.style.cursor = 'pointer';
        statusBadge.title = 'Click to cycle status';

        function updateStatusDisplay() {
          const statuses = ['pending', 'in-progress', 'completed'];
          const labels = ['Pending', 'In Progress', 'Completed'];
          const colors = ['status-pending', 'status-in-progress', 'status-completed'];
          const idx = statuses.indexOf(ref.status || 'pending');
          statusBadge.textContent = labels[idx];
          statusBadge.className = 'status-badge ' + colors[idx];
        }

        updateStatusDisplay();

        statusBadge.addEventListener('click', () => {
          const statuses = ['pending', 'in-progress', 'completed'];
          const current = ref.status || 'pending';
          const currentIndex = statuses.indexOf(current);
          const nextIndex = (currentIndex + 1) % statuses.length;
          ref.status = statuses[nextIndex];
          updateStatusDisplay();
          saveData(data);
          renderWeek();
        });

        tdStatus.appendChild(statusBadge);
        tr.appendChild(tdStatus);

        const tdActions = document.createElement('td');
        const actionsDiv = document.createElement('div');
        actionsDiv.style.display = 'flex';
        actionsDiv.style.flexDirection = 'column';
        actionsDiv.style.gap = '4px';

        // Move to another day
        const moveSelect = document.createElement('select');
        moveSelect.innerHTML = '<option value="">Move to...</option>';
        week.forEach(d => {
          if (d.iso !== day.iso) {
            const opt = document.createElement('option');
            opt.value = d.iso;
            opt.textContent = d.name;
            moveSelect.appendChild(opt);
          }
        });
        moveSelect.addEventListener('change', () => {
          const targetDay = moveSelect.value;
          if (!targetDay) return;
          data[targetDay] = data[targetDay] || [];
          data[targetDay].push({...ref});
          data[day.iso].splice(data[day.iso].indexOf(ref), 1);
          saveData(data);
          renderWeek();
        });
        actionsDiv.appendChild(moveSelect);

        // Modify Button
        const editBtn = document.createElement('button');
        editBtn.className = 'small';
        editBtn.textContent = '‚úèÔ∏è Modify';
        editBtn.title = 'Edit this reference';
        editBtn.addEventListener('click', () => {
          // Pre-fill the add form in this day
          const addRow = section.querySelector('.add-row');
          addRow.querySelector('input[placeholder="B1 Number"]').value = ref.b1Number || '';
          addRow.querySelector('input[placeholder="Remorque"]').value = ref.remorque || '';
          addRow.querySelector('select').value = ref.user || '';
          // Change button to "Update"
          const addButton = addRow.querySelector('button');
          addButton.textContent = 'üíæ Update';
          // Store original ref for update
          addButton.onclick = null;
          addButton.addEventListener('click', function updateNow() {
            const b1 = addRow.querySelector('input[placeholder="B1 Number"]').value.trim();
            const remorque = addRow.querySelector('input[placeholder="Remorque"]').value.trim();
            const user = addRow.querySelector('select').value;

            if (!b1 || !remorque) {
              alert('B1 and Remorque are required.');
              return;
            }

            ref.b1Number = b1;
            ref.remorque = remorque;
            ref.user = user;
            saveData(data);
            addButton.textContent = 'Add Reference';
            addButton.onclick = null;
            addButton.addEventListener('click', addButton.originalClick);
            renderWeek();
          });
        });
        actionsDiv.appendChild(editBtn);

        // Delete Button
        const delBtn = document.createElement('button');
        delBtn.className = 'danger small';
        delBtn.innerHTML = 'üóë Delete';
        delBtn.addEventListener('click', () => {
          if (confirm('Delete this reference?')) {
            data[day.iso].splice(data[day.iso].indexOf(ref), 1);
            saveData(data);
            renderWeek();
          }
        });
        actionsDiv.appendChild(delBtn);

        tdActions.appendChild(actionsDiv);
        tr.appendChild(tdActions);
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      section.appendChild(table);

      // Add Reference Form
      const addRow = document.createElement('div');
      addRow.className = 'add-row';

      const b1Input = document.createElement('input');
      b1Input.type = 'text';
      b1Input.placeholder = 'B1 Number';

      const remorqueInput = document.createElement('input');
      remorqueInput.type = 'text';
      remorqueInput.placeholder = 'Remorque';

      const userSelect = document.createElement('select');
      const defaultOption = document.createElement('option');
      defaultOption.value = '';
      defaultOption.textContent = 'Assign To';
      userSelect.appendChild(defaultOption);
      users.forEach(user => {
        const option = document.createElement('option');
        option.value = user;
        option.textContent = user;
        userSelect.appendChild(option);
      });

      const addButton = document.createElement('button');
      addButton.textContent = 'Add Reference';
      addButton.originalClick = function() {
        const b1 = b1Input.value.trim();
        const remorque = remorqueInput.value.trim();
        const user = userSelect.value;

        if (!b1 || !remorque) {
          alert('Please enter both B1 Number and Remorque.');
          return;
        }

        data[day.iso].push({
          b1Number: b1,
          remorque,
          user: user,
          status: 'pending'
        });
        saveData(data);
        b1Input.value = '';
        remorqueInput.value = '';
        userSelect.value = '';
        renderWeek();
      };
      addButton.addEventListener('click', addButton.originalClick);
      addRow.appendChild(b1Input);
      addRow.appendChild(remorqueInput);
      addRow.appendChild(userSelect);
      addRow.appendChild(addButton);
      section.appendChild(addRow);

      container.appendChild(section);
    });

    attachSearchFilter(data);
  }

  function attachSearchFilter(data) {
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', () => {
      const query = searchInput.value.toLowerCase().trim();
      if (!query) return renderWeek();
      const week = generateWeekDates();
      const container = document.getElementById('weeklyTables');
      container.innerHTML = '';
      let found = false;
      week.forEach(day => {
        const matches = data[day.iso].filter(r =>
          (r.b1Number || '').toLowerCase().includes(query) ||
          (r.remorque || '').toLowerCase().includes(query)
        );
        if (matches.length > 0) {
          found = true;
          const section = document.createElement('div');
          section.className = 'day-table';
          const header = document.createElement('div');
          header.className = 'day-header';
          header.textContent = `${day.name} - ${day.date} (${matches.length} match${matches.length > 1 ? 'es' : ''})`;
          section.appendChild(header);
          const table = document.createElement('table');
          const thead = document.createElement('thead');
          const headerRow = document.createElement('tr');
          ['B1 NUMBER', 'REMORQUE', 'ASSIGNED TO', 'STATUS', 'ACTIONS'].forEach(text => {
            const th = document.createElement('th');
            th.textContent = text;
            headerRow.appendChild(th);
          });
          thead.appendChild(headerRow);
          table.appendChild(thead);
          const tbody = document.createElement('tbody');
          matches.forEach(ref => {
            const tr = document.createElement('tr');
            ['b1Number', 'remorque'].forEach(key => {
              const td = document.createElement('td');
              td.textContent = ref[key] || '';
              tr.appendChild(td);
            });
            const tdUser = document.createElement('td');
            tdUser.textContent = ref.user || 'Unassigned';
            tr.appendChild(tdUser);
            const tdStatus = document.createElement('td');
            tdStatus.innerHTML = ref.status === 'completed' ? '‚úÖ' : ref.status === 'in-progress' ? 'üü°' : '‚ùå';
            tr.appendChild(tdStatus);
            const tdActions = document.createElement('td');
            tdActions.textContent = '‚Äî';
            tr.appendChild(tdActions);
            tbody.appendChild(tr);
          });
          table.appendChild(tbody);
          section.appendChild(table);
          container.appendChild(section);
        }
      });
      if (!found) {
        container.innerHTML = '<p style="text-align:center; color:#6b7280; padding:30px;">No references found matching your search.</p>';
      }
    });
  }

  // Initial render
  renderWeek();
</script>

</body>
</html>